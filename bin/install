#!/usr/bin/env bash

# shellcheck source=./exec-env
source "$(dirname "$0")/exec-env"

install_rust() {
    RUSTUP_INIT_SKIP_PATH_CHECK=yes rustup-init -y --no-modify-path --default-toolchain "$ASDF_INSTALL_VERSION"
}

install_default_cargo_packages() {
    local default_cargo_packages_file="${ASDF_CRATE_DEFAULT_PACKAGES_FILE:-$HOME/.default-cargo-crates}" filtered_packages=

    if [ -f "$default_cargo_packages_file" ]; then
        echo -ne "\nInstalling default cargo packages..."

        filtered_packages=$(grep -vE "^\s*#" <"$default_cargo_packages_file")
        xargs env PATH="$ASDF_INSTALL_PATH/bin:$PATH" cargo install <<<"$filtered_packages"
    fi
}

install_rust
install_default_cargo_packages
